
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Practical patterns and drills for high-quality Python development with geospatial data">
      
      
      
      
        <link rel="prev" href="../day03_api/">
      
      
        <link rel="next" href="../day05_data/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Overview - Python Geospatial Engineering Practices</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#day-04-testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Python Geospatial Engineering Practices" class="md-header__button md-logo" aria-label="Python Geospatial Engineering Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Python Geospatial Engineering Practices
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Overview
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="red"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="red"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../study_plan/" class="md-tabs__link">
          
  
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../day01_concurrency/" class="md-tabs__link">
          
  
  
  Training Modules

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Python Geospatial Engineering Practices" class="md-nav__button md-logo" aria-label="Python Geospatial Engineering Practices" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Python Geospatial Engineering Practices
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../study_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Study Plan
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Training Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Training Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 01 - Concurrency
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Day 01 - Concurrency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day01_concurrency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 02 - Oop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Day 02 - Oop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day02_oop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 03 - Api
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Day 03 - Api
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day03_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 04 - Testing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Day 04 - Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theoretical-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Theoretical Foundation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Theoretical Foundation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quality-engineering-in-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Engineering in Geospatial Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-pyramid-for-geospatial-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Pyramid for Geospatial Applications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tdd-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      1) TDD Cycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pytest-essentials" class="md-nav__link">
    <span class="md-ellipsis">
      2) pytest Essentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-testing-pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      3) Testing Pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough-this-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough (this repo)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Walkthrough (this repo)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-api-smoke-tests" class="md-nav__link">
    <span class="md-ellipsis">
      1) API Smoke Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-test-client-usage" class="md-nav__link">
    <span class="md-ellipsis">
      2) Test Client Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unit-tests-for-roadnetwork" class="md-nav__link">
    <span class="md-ellipsis">
      1) Unit Tests for RoadNetwork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2) API Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-property-based-testing-with-hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      3) Property-Based Testing with Hypothesis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-fixtures-and-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      1) Fixtures and Dependency Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-parametrized-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2) Parametrized Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mocking-external-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      3) Mocking External Dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-testing-lightweight" class="md-nav__link">
    <span class="md-ellipsis">
      Load Testing (lightweight)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Testing (lightweight)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pytest-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      1) pytest-benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-load-testing-with-locust" class="md-nav__link">
    <span class="md-ellipsis">
      2. Load Testing with Locust
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Test Coverage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-measuring-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      1. Measuring Coverage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-coverage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      2. Coverage Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-test-organization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Test Organization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-test-naming" class="md-nav__link">
    <span class="md-ellipsis">
      2. Test Naming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-test-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      3. Test Data Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-testing-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      1. Testing Implementation Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-over-mocking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Over-Mocking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ignoring-edge-cases" class="md-nav__link">
    <span class="md-ellipsis">
      3. Ignoring Edge Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-testing-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Testing Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Testing Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaos-engineering-for-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Chaos Engineering for Geospatial Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutation-testing-for-spatial-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Mutation Testing for Spatial Algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzing-for-geospatial-input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Fuzzing for Geospatial Input Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-and-load-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Performance and Load Testing Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cicd-integration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      CI/CD Integration Patterns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-driven-testing-for-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Data-Driven Testing for Geospatial Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data-Driven Testing for Geospatial Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      Test Data Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-frameworks-and-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Frameworks and Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geospatial-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Geospatial Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Engineering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaos-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Chaos Engineering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 05 - Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Day 05 - Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day05_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 06 - Perf
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Day 06 - Perf
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day06_perf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Day 07 - Mock
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            Day 07 - Mock
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../day07_mock/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theoretical-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      Theoretical Foundation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Theoretical Foundation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quality-engineering-in-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Engineering in Geospatial Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-pyramid-for-geospatial-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Pyramid for Geospatial Applications
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Core Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tdd-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      1) TDD Cycle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-pytest-essentials" class="md-nav__link">
    <span class="md-ellipsis">
      2) pytest Essentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-testing-pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      3) Testing Pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-walkthrough-this-repo" class="md-nav__link">
    <span class="md-ellipsis">
      Code Walkthrough (this repo)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Code Walkthrough (this repo)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-api-smoke-tests" class="md-nav__link">
    <span class="md-ellipsis">
      1) API Smoke Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-test-client-usage" class="md-nav__link">
    <span class="md-ellipsis">
      2) Test Client Usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exercises">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unit-tests-for-roadnetwork" class="md-nav__link">
    <span class="md-ellipsis">
      1) Unit Tests for RoadNetwork
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-api-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2) API Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-property-based-testing-with-hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      3) Property-Based Testing with Hypothesis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-fixtures-and-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      1) Fixtures and Dependency Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-parametrized-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2) Parametrized Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mocking-external-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      3) Mocking External Dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-testing-lightweight" class="md-nav__link">
    <span class="md-ellipsis">
      Load Testing (lightweight)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Load Testing (lightweight)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pytest-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      1) pytest-benchmark
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-load-testing-with-locust" class="md-nav__link">
    <span class="md-ellipsis">
      2. Load Testing with Locust
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Test Coverage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Coverage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-measuring-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      1. Measuring Coverage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-coverage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      2. Coverage Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-test-organization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Test Organization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-test-naming" class="md-nav__link">
    <span class="md-ellipsis">
      2. Test Naming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-test-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      3. Test Data Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-testing-implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      1. Testing Implementation Details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-over-mocking" class="md-nav__link">
    <span class="md-ellipsis">
      2. Over-Mocking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ignoring-edge-cases" class="md-nav__link">
    <span class="md-ellipsis">
      3. Ignoring Edge Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-testing-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Testing Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Testing Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#chaos-engineering-for-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Chaos Engineering for Geospatial Systems
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutation-testing-for-spatial-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Mutation Testing for Spatial Algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzing-for-geospatial-input-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Fuzzing for Geospatial Input Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-and-load-testing-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Performance and Load Testing Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cicd-integration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      CI/CD Integration Patterns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-driven-testing-for-geospatial-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Data-Driven Testing for Geospatial Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data-Driven Testing for Geospatial Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      Test Data Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-frameworks-and-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Frameworks and Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geospatial-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Geospatial Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Quality Engineering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaos-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Chaos Engineering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="day-04-testing">Day 04 - Testing</h1>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>This module covers comprehensive testing strategies essential for enterprise geospatial systems, emphasizing quality engineering practices that ensure reliability, performance, and maintainability at scale. By the end of this module, you will understand:</p>
<ul>
<li><strong>Test-Driven Development (TDD) and Behavior-Driven Development (BDD)</strong> for geospatial domain modeling</li>
<li><strong>Advanced pytest patterns</strong> including fixtures, parametrization, plugins, and custom test discovery</li>
<li><strong>Property-based testing with Hypothesis</strong> for robust geospatial algorithm validation</li>
<li><strong>Integration testing strategies</strong> for distributed geospatial services and external API dependencies</li>
<li><strong>Performance testing methodologies</strong> including load, stress, spike, and endurance testing</li>
<li><strong>Mutation testing and fuzzing</strong> for ensuring test quality and edge case coverage</li>
<li><strong>Test automation in CI/CD pipelines</strong> with geographic data and spatial analysis workflows</li>
<li><strong>Chaos engineering principles</strong> for testing system resilience under failure conditions</li>
</ul>
<h2 id="theoretical-foundation">Theoretical Foundation</h2>
<h3 id="quality-engineering-in-geospatial-systems">Quality Engineering in Geospatial Systems</h3>
<p><strong>Spatial Data Complexity:</strong>
Geospatial systems face unique testing challenges:
- <strong>Coordinate precision</strong>: Floating-point arithmetic and transformation accuracy
- <strong>Topology validation</strong>: Ensuring geometric integrity across operations<br />
- <strong>Scale variability</strong>: Testing from millimeter precision to global datasets
- <strong>Temporal dimensions</strong>: Time-series spatial data and change detection
- <strong>Multi-format support</strong>: Ensuring consistency across GeoJSON, WKT, MVT, etc.</p>
<p><strong>Distributed System Testing:</strong>
Modern geospatial architectures require sophisticated testing approaches:
- <strong>Service mesh testing</strong>: Inter-service communication and failure scenarios
- <strong>Event-driven architecture validation</strong>: Async message processing and ordering
- <strong>Spatial indexing correctness</strong>: R-tree, quadtree, and H3 index validation
- <strong>Cache coherence testing</strong>: Multi-level caching with spatial invalidation</p>
<h3 id="testing-pyramid-for-geospatial-applications">Testing Pyramid for Geospatial Applications</h3>
<div class="highlight"><pre><span></span><code>                    /\
                   /  \     Manual Exploratory Testing
                  /____\    (Map visual validation, UX testing)
                 /      \   
                /        \  End-to-End Integration Tests
               /__________\ (Full pipeline, external services)
              /            \
             /              \ Contract/API Tests  
            /________________\ (Service boundaries, protocols)
           /                  \
          /                    \ Component/Service Tests
         /______________________\ (Business logic, spatial operations)
        /                        \
       /                          \ Unit Tests
      /____________________________\ (Pure functions, algorithms, data structures)
</code></pre></div>
<p><strong>Optimal Distribution (Geospatial Systems):</strong>
- <strong>Unit Tests (70%)</strong>: Spatial algorithms, coordinate transformations, geometric operations
- <strong>Component Tests (20%)</strong>: Provider integrations, spatial queries, cache behavior<br />
- <strong>Integration Tests (8%)</strong>: API contracts, database transactions, external service mocks
- <strong>E2E Tests (2%)</strong>: Critical user workflows, visual map rendering validation</p>
<h2 id="core-concepts">Core Concepts</h2>
<h3 id="1-tdd-cycle">1) TDD Cycle</h3>
<p>Red → Green → Refactor. Target small, observable units and keep test names behavior-focused.</p>
<h3 id="2-pytest-essentials">2) pytest Essentials</h3>
<p>pytest is a powerful testing framework that makes testing simple and scalable:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_simple</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">4</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_with_fixture</span><span class="p">(</span><span class="n">sample_data</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;input,expected&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_doubling</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">input</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">expected</span>
</code></pre></div>
<h3 id="3-testing-pyramid">3) Testing Pyramid</h3>
<div class="highlight"><pre><span></span><code>    /\
   /  \     E2E Tests (Few, Slow)
  /____\    
 /      \   Integration Tests (Some, Medium)
/________\  Unit Tests (Many, Fast)
</code></pre></div>
<ul>
<li><strong>Unit Tests</strong>: Test individual functions/methods in isolation</li>
<li><strong>Integration Tests</strong>: Test how components work together</li>
<li><strong>End-to-End Tests</strong>: Test complete user workflows</li>
</ul>
<h2 id="code-walkthrough-this-repo">Code Walkthrough (this repo)</h2>
<h3 id="1-api-smoke-tests">1) API Smoke Tests</h3>
<p><code>src/day04_testing/tests/test_smoke.py</code> verifies the Day 3 API routes.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.testclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.day03_api.app</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_tiles_smoke</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/tiles/0/0/0.mvt&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_stream_features_invalid_bbox</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/stream-features&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
        <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">})</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span>
</code></pre></div>
<p><strong>Key Points:</strong>
- <code>TestClient</code>: FastAPI's testing utility that simulates HTTP requests
- <strong>Arrange-Act-Assert</strong>: Clear test structure
- <strong>Descriptive names</strong>: Test names explain what they're testing</p>
<h3 id="2-test-client-usage">2) Test Client Usage</h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.testclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>

<span class="c1"># Create a test client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="c1"># Test GET requests</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/endpoint&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/endpoint&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;param&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>

<span class="c1"># Test POST requests</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/endpoint&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>

<span class="c1"># Test headers</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/endpoint&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token&quot;</span><span class="p">})</span>

<span class="c1"># Assertions</span>
<span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
<span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;expected_value&quot;</span>
<span class="k">assert</span> <span class="s2">&quot;expected_header&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>
</code></pre></div>
<h2 id="running-tests">Running Tests</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Activate virtual environment</span>
<span class="nb">source</span><span class="w"> </span>.venv/bin/activate

<span class="c1"># Run all tests</span>
pytest

<span class="c1"># Run with verbose output</span>
pytest<span class="w"> </span>-v

<span class="c1"># Run specific test file</span>
pytest<span class="w"> </span>src/day04_testing/tests/test_smoke.py

<span class="c1"># Run specific test function</span>
pytest<span class="w"> </span>src/day04_testing/tests/test_smoke.py::test_tiles_smoke
</code></pre></div>
<h3 id="options">Options</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Run tests and show coverage</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>src

<span class="c1"># Run tests in parallel</span>
pytest<span class="w"> </span>-n<span class="w"> </span>auto

<span class="c1"># Stop on first failure</span>
pytest<span class="w"> </span>-x

<span class="c1"># Show local variables on failure</span>
pytest<span class="w"> </span>-l

<span class="c1"># Run only tests matching a pattern</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;bbox&quot;</span>
</code></pre></div>
<h2 id="exercises">Exercises</h2>
<h3 id="1-unit-tests-for-roadnetwork">1) Unit Tests for RoadNetwork</h3>
<p>Create <code>test_road_network.py</code> to test the core data processing:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.day07_mock.mock_test.road_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoadNetwork</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">mock_open</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestRoadNetwork</span><span class="p">:</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_csv_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;road_id,name,geometry,speed_limit,road_type,last_updated</span>
<span class="s2">R001,El Camino Real,&quot;LINESTRING(-122.123 37.456, -122.124 37.457)&quot;,50,arterial,2024-01-15T10:00:00Z</span>
<span class="s2">R002,Page Mill Rd,&quot;LINESTRING(-122.124 37.457, -122.125 37.458)&quot;,40,residential,2024-01-15T10:00:00Z&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">road_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_csv_data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;builtins.open&quot;</span><span class="p">,</span> <span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">sample_csv_data</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;csv.DictReader&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_reader</span><span class="p">:</span>
                <span class="n">mock_reader</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;road_id&quot;</span><span class="p">:</span> <span class="s2">&quot;R001&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;El Camino Real&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="s2">&quot;LINESTRING(-122.123 37.456, -122.124 37.457)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;speed_limit&quot;</span><span class="p">:</span> <span class="s2">&quot;50&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;road_type&quot;</span><span class="p">:</span> <span class="s2">&quot;arterial&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:00:00Z&quot;</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;road_id&quot;</span><span class="p">:</span> <span class="s2">&quot;R002&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Page Mill Rd&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="s2">&quot;LINESTRING(-122.124 37.457, -122.125 37.458)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;speed_limit&quot;</span><span class="p">:</span> <span class="s2">&quot;40&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;road_type&quot;</span><span class="p">:</span> <span class="s2">&quot;residential&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-15T10:00:00Z&quot;</span>
                    <span class="p">}</span>
                <span class="p">]</span>
                <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;dummy_path.csv&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">network</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_loads_roads_correctly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">road_network</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">road_network</span><span class="o">.</span><span class="n">_roads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="k">assert</span> <span class="s2">&quot;R001&quot;</span> <span class="ow">in</span> <span class="n">road_network</span><span class="o">.</span><span class="n">_roads</span>
        <span class="k">assert</span> <span class="s2">&quot;R002&quot;</span> <span class="ow">in</span> <span class="n">road_network</span><span class="o">.</span><span class="n">_roads</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_find_roads_in_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">road_network</span><span class="p">):</span>
        <span class="n">roads</span> <span class="o">=</span> <span class="n">road_network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="mf">37.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.13</span><span class="p">,</span> <span class="mf">37.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.12</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_connected_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">road_network</span><span class="p">):</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">road_network</span><span class="o">.</span><span class="n">get_connected_roads</span><span class="p">(</span><span class="s2">&quot;R001&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">&quot;R002&quot;</span> <span class="ow">in</span> <span class="n">connected</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">road_network</span><span class="p">):</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">road_network</span><span class="o">.</span><span class="n">update_road</span><span class="p">(</span><span class="s2">&quot;R001&quot;</span><span class="p">,</span> <span class="n">speed_limit</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">updated</span><span class="o">.</span><span class="n">speed_limit</span> <span class="o">==</span> <span class="mi">60</span>
        <span class="k">assert</span> <span class="n">updated</span><span class="o">.</span><span class="n">road_type</span> <span class="o">==</span> <span class="s2">&quot;arterial&quot;</span>  <span class="c1"># Unchanged</span>
</code></pre></div>
<h3 id="2-api-tests">2) API Tests</h3>
<p>Create comprehensive API tests:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.testclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.day07_mock.mock_test.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestAPI</span><span class="p">:</span>
    <span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_roads_bbox_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
            <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span>
        <span class="p">})</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FeatureCollection&quot;</span>
        <span class="k">assert</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_roads_bbox_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
            <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span>  <span class="c1"># Invalid bbox</span>
        <span class="p">})</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_roads_bbox_pagination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
            <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">,</span>
            <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;offset&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">})</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_connected_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/R001/connected&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_road</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;speed_limit&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/roads/R001/update&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">update_data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;speed_limit&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">55</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_road_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;speed_limit&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">}</span>  <span class="c1"># Invalid speed</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/roads/R001/update&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">update_data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">422</span>  <span class="c1"># Validation error</span>
</code></pre></div>
<h3 id="3-property-based-testing-with-hypothesis">3) Property-Based Testing with Hypothesis</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">strategies</span> <span class="k">as</span> <span class="n">st</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">box</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.day07_mock.mock_test.road_network</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoadNetwork</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestRoadNetworkProperties</span><span class="p">:</span>
    <span class="nd">@given</span><span class="p">(</span>
        <span class="n">min_lat</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>
        <span class="n">min_lon</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">180</span><span class="p">),</span>
        <span class="n">max_lat</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>
        <span class="n">max_lon</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query_always_returns_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">):</span>
        <span class="c1"># Skip invalid bboxes</span>
        <span class="k">if</span> <span class="n">min_lat</span> <span class="o">&gt;</span> <span class="n">max_lat</span> <span class="ow">or</span> <span class="n">min_lon</span> <span class="o">&gt;</span> <span class="n">max_lon</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create a minimal network for testing</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;dummy_path.csv&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="nd">@given</span><span class="p">(</span>
        <span class="n">road_id</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">min_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_connected_roads_always_returns_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">road_id</span><span class="p">):</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;dummy_path.csv&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_connected_roads</span><span class="p">(</span><span class="n">road_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
<h2 id="advanced-techniques">Advanced Techniques</h2>
<h3 id="1-fixtures-and-dependency-injection">1) Fixtures and Dependency Injection</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mock</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mock_database</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mock database connection for testing.&quot;&quot;&quot;</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Test Road&quot;</span><span class="p">}</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">db</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_geojson</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample GeoJSON data for testing.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;FeatureCollection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Feature&quot;</span><span class="p">,</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;R001&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Test Road&quot;</span><span class="p">},</span>
                <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;LineString&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="o">-</span><span class="mf">122.123</span><span class="p">,</span> <span class="mf">37.456</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">122.124</span><span class="p">,</span> <span class="mf">37.457</span><span class="p">]]</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_with_fixtures</span><span class="p">(</span><span class="n">mock_database</span><span class="p">,</span> <span class="n">sample_geojson</span><span class="p">):</span>
    <span class="c1"># Use the fixtures in your test</span>
    <span class="k">assert</span> <span class="n">mock_database</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">called</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_geojson</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>
<h3 id="2-parametrized-tests">2) Parametrized Tests</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;bbox,expected_count&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">((</span><span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># Large bbox</span>
    <span class="p">((</span><span class="mf">37.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.13</span><span class="p">,</span> <span class="mf">37.46</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.12</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># Small bbox</span>
    <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># No roads in this area</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_queries</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">expected_count</span><span class="p">):</span>
    <span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span> <span class="o">=</span> <span class="n">bbox</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;test_data.csv&quot;</span><span class="p">)</span>
    <span class="n">roads</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected_count</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;invalid_bbox&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span><span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">),</span>  <span class="c1"># min_lat &gt; max_lat</span>
    <span class="p">(</span><span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">),</span>  <span class="c1"># min_lon &gt; max_lon</span>
<span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_invalid_bbox_raises_error</span><span class="p">(</span><span class="n">invalid_bbox</span><span class="p">):</span>
    <span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span> <span class="o">=</span> <span class="n">invalid_bbox</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;test_data.csv&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-mocking-external-dependencies">3) Mocking External Dependencies</h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">unittest.mock</span><span class="w"> </span><span class="kn">import</span> <span class="n">patch</span><span class="p">,</span> <span class="n">MagicMock</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_tile_fetching_with_mock</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;httpx.AsyncClient&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_client</span><span class="p">:</span>
        <span class="c1"># Setup mock response</span>
        <span class="n">mock_response</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">mock_response</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;fake_tile_data&quot;</span>
        <span class="n">mock_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">mock_client_instance</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="n">mock_client_instance</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_response</span>
        <span class="n">mock_client</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="fm">__aenter__</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">mock_client_instance</span>

        <span class="c1"># Test the function</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.day01_concurrency.tile_fetcher</span><span class="w"> </span><span class="kn">import</span> <span class="n">fetch_tile</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_tile</span><span class="p">(</span><span class="n">mock_client_instance</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;fake_tile_data&quot;</span>
</code></pre></div>
<h2 id="load-testing-lightweight">Load Testing (lightweight)</h2>
<h3 id="1-pytest-benchmark">1) pytest-benchmark</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastapi.testclient</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.day07_mock.mock_test.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_api_performance</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_request</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
            <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span>
        <span class="p">})</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">make_request</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_concurrent_requests</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_concurrent_requests</span><span class="p">():</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
                    <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span>
                <span class="p">})</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">responses</span>

    <span class="c1"># This would need a running server</span>
    <span class="c1"># result = benchmark(lambda: asyncio.run(make_concurrent_requests()))</span>
</code></pre></div>
<h3 id="2-load-testing-with-locust">2. Load Testing with Locust</h3>
<p>Create <code>locustfile.py</code> for more sophisticated load testing:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">locust</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpUser</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">between</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RoadNetworkUser</span><span class="p">(</span><span class="n">HttpUser</span><span class="p">):</span>
    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">between</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/bbox&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;min_lat&quot;</span><span class="p">:</span> <span class="mf">37.0</span><span class="p">,</span> <span class="s2">&quot;min_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span>
            <span class="s2">&quot;max_lat&quot;</span><span class="p">:</span> <span class="mf">38.0</span><span class="p">,</span> <span class="s2">&quot;max_lon&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">121.0</span>
        <span class="p">})</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_connected_roads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/roads/R001/connected&quot;</span><span class="p">)</span>

    <span class="nd">@task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_update_road</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/roads/R001/update&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;speed_limit&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">})</span>
</code></pre></div>
<h2 id="test-coverage">Test Coverage</h2>
<h3 id="1-measuring-coverage">1. Measuring Coverage</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install coverage tools</span>
pip<span class="w"> </span>install<span class="w"> </span>pytest-cov

<span class="c1"># Run tests with coverage</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>src<span class="w"> </span>--cov-report<span class="o">=</span>html

<span class="c1"># Generate detailed coverage report</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>src<span class="w"> </span>--cov-report<span class="o">=</span>term-missing
</code></pre></div>
<h3 id="2-coverage-configuration">2. Coverage Configuration</h3>
<p>Create <code>.coveragerc</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="k">[run]</span>
<span class="na">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">src</span>
<span class="na">omit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="na">*/tests/*</span>
<span class="w">    </span><span class="na">*/__init__.py</span>

<span class="k">[report]</span>
<span class="na">exclude_lines</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="na">pragma</span><span class="o">:</span><span class="w"> </span><span class="s">no cover</span>
<span class="w">    </span><span class="na">def __repr__</span>
<span class="w">    </span><span class="na">raise AssertionError</span>
<span class="w">    </span><span class="na">raise NotImplementedError</span>
</code></pre></div>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-test-organization">1. Test Organization</h3>
<div class="highlight"><pre><span></span><code>tests/
├── unit/           # Unit tests
│   ├── test_road_network.py
│   └── test_api.py
├── integration/    # Integration tests
│   └── test_end_to_end.py
└── conftest.py    # Shared fixtures
</code></pre></div>
<h3 id="2-test-naming">2. Test Naming</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ✅ Descriptive test names</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_find_roads_in_bbox_returns_empty_list_for_area_with_no_roads</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_update_road_speed_limit_updates_correct_field</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># ❌ Unclear test names</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_bbox</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_update</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>
<h3 id="3-test-data-management">3. Test Data Management</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">sample_roads_data</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load test data once for all tests.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">load_test_data_from_file</span><span class="p">(</span><span class="s2">&quot;sample_roads.csv&quot;</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span><span class="w"> </span><span class="nf">road_network</span><span class="p">(</span><span class="n">sample_roads_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create fresh network for each test.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;builtins.open&quot;</span><span class="p">,</span> <span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">sample_roads_data</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;dummy_path.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<h3 id="1-testing-implementation-details">1. Testing Implementation Details</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ Testing internal state</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_internal_index</span><span class="p">():</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;_index&quot;</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="vm">__dict__</span>  <span class="c1"># Too specific</span>

<span class="c1"># ✅ Testing public behavior</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_can_find_road_by_id</span><span class="p">():</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
    <span class="n">road</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_road_by_id</span><span class="p">(</span><span class="s2">&quot;R001&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">road</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="2-over-mocking">2. Over-Mocking</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ Mocking everything</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;pathlib.Path&quot;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;csv.DictReader&quot;</span><span class="p">)</span>
<span class="nd">@patch</span><span class="p">(</span><span class="s2">&quot;shapely.wkt.loads&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_over_mocked</span><span class="p">(</span><span class="n">mock_loads</span><span class="p">,</span> <span class="n">mock_reader</span><span class="p">,</span> <span class="n">mock_path</span><span class="p">):</span>
    <span class="c1"># Test becomes brittle and hard to maintain</span>

<span class="c1"># ✅ Mock only external dependencies</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_with_minimal_mocking</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s2">&quot;builtins.open&quot;</span><span class="p">,</span> <span class="n">mock_open</span><span class="p">(</span><span class="n">read_data</span><span class="o">=</span><span class="n">sample_csv</span><span class="p">)):</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">RoadNetwork</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
        <span class="c1"># Test the actual logic</span>
</code></pre></div>
<h3 id="3-ignoring-edge-cases">3. Ignoring Edge Cases</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># ❌ Only testing happy path</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query</span><span class="p">():</span>
    <span class="n">roads</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># ✅ Test edge cases too</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query_empty_area</span><span class="p">():</span>
    <span class="n">roads</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">roads</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query_invalid_coordinates</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">network</span><span class="o">.</span><span class="n">find_roads_in_bbox</span><span class="p">(</span><span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">)</span>
</code></pre></div>
<h2 id="next-steps">Next Steps</h2>
<p>After completing this day:
1. Achieve &gt;80% test coverage on core functionality
2. Add integration tests with real data
3. Implement performance benchmarks
4. Set up continuous integration (CI) pipeline
5. Add property-based tests for complex logic</p>
<h2 id="advanced-testing-patterns">Advanced Testing Patterns</h2>
<h3 id="chaos-engineering-for-geospatial-systems">Chaos Engineering for Geospatial Systems</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SpatialChaosExperiment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chaos engineering for testing spatial system resilience.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spatial_service</span><span class="p">:</span> <span class="n">SpatialService</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">spatial_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures_injected</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">inject_coordinate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drift_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inject small coordinate drifts to test precision handling.&quot;&quot;&quot;</span>
        <span class="n">original_transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">coordinate_transformer</span><span class="o">.</span><span class="n">transform</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">drifted_transform</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="n">drift_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">drift_factor</span>
            <span class="n">drift_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">drift_factor</span>
            <span class="k">return</span> <span class="n">original_transform</span><span class="p">(</span><span class="n">drift_x</span><span class="p">,</span> <span class="n">drift_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">coordinate_transformer</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">drifted_transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failures_injected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;coordinate_drift&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">simulate_spatial_index_corruption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simulate partial spatial index corruption.&quot;&quot;&quot;</span>
        <span class="c1"># Randomly remove some entries from spatial index</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="p">,</span> <span class="s1">&#39;_spatial_index&#39;</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">_spatial_index</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">bounds</span><span class="p">))</span>
            <span class="n">corrupted_entries</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">entry_id</span> <span class="ow">in</span> <span class="n">corrupted_entries</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">entry_id</span><span class="p">,</span> <span class="n">index</span><span class="o">.</span><span class="n">get_bounds</span><span class="p">(</span><span class="n">entry_id</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Index might already be corrupted</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">failures_injected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;index_corruption&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">induce_memory_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create memory pressure to test resource handling.&quot;&quot;&quot;</span>
        <span class="n">memory_hog</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Allocate memory in chunks</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_mb</span><span class="p">):</span>
                <span class="n">memory_hog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;x&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">))</span>  <span class="c1"># 1MB chunks</span>

            <span class="c1"># Hold memory for test duration</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">memory_hog</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">failures_injected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;memory_pressure&quot;</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">chaos_experiment</span><span class="p">(</span><span class="n">spatial_service</span><span class="p">):</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">SpatialChaosExperiment</span><span class="p">(</span><span class="n">spatial_service</span><span class="p">)</span>
    <span class="k">yield</span> <span class="n">experiment</span>

    <span class="c1"># Cleanup: restore original state if possible</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">spatial_service</span><span class="p">,</span> <span class="s1">&#39;_reset_to_clean_state&#39;</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">spatial_service</span><span class="o">.</span><span class="n">_reset_to_clean_state</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSpatialResilience</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test suite for spatial system resilience under chaos conditions.&quot;&quot;&quot;</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_query_under_coordinate_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chaos_experiment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that bbox queries remain stable under coordinate drift.&quot;&quot;&quot;</span>
        <span class="c1"># Inject coordinate drift</span>
        <span class="k">await</span> <span class="n">chaos_experiment</span><span class="o">.</span><span class="n">inject_coordinate_drift</span><span class="p">(</span><span class="n">drift_factor</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>

        <span class="c1"># Original query</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">)</span>
        <span class="n">results_before</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chaos_experiment</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">query_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

        <span class="c1"># Query with drift should still return reasonable results</span>
        <span class="n">results_after</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chaos_experiment</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">query_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

        <span class="c1"># Results should be similar (allowing for some drift tolerance)</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_before</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_after</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">2</span>

    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_spatial_operations_during_memory_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chaos_experiment</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test spatial operations continue working under memory pressure.&quot;&quot;&quot;</span>
        <span class="c1"># Create memory pressure</span>
        <span class="n">memory_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span>
            <span class="n">chaos_experiment</span><span class="o">.</span><span class="n">induce_memory_pressure</span><span class="p">(</span><span class="n">target_mb</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Perform spatial operations during memory pressure</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">37.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">121.0</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">chaos_experiment</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">query_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

            <span class="c1"># Should not fail completely, might have reduced performance</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">memory_task</span>
</code></pre></div>
<h3 id="mutation-testing-for-spatial-algorithms">Mutation Testing for Spatial Algorithms</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Install: pip install mutmut</span>
<span class="c1"># Usage: mutmut run --paths-to-mutate=src/spatial_algorithms/</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestSpatialAlgorithmRobustness</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test suite designed to catch mutations in spatial algorithms.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_distance_calculation_edge_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Comprehensive tests to catch distance calculation mutations.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.spatial_algorithms</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_distance</span>

        <span class="c1"># Test identical points</span>
        <span class="k">assert</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="c1"># Test symmetric property</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">d2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>

        <span class="c1"># Test triangle inequality</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d12</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">d23</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="o">*</span><span class="n">p2</span><span class="p">,</span> <span class="o">*</span><span class="n">p3</span><span class="p">)</span>
        <span class="n">d13</span> <span class="o">=</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="o">*</span><span class="n">p3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">d12</span> <span class="o">+</span> <span class="n">d23</span> <span class="o">&gt;=</span> <span class="n">d13</span> <span class="o">-</span> <span class="mf">1e-10</span>

        <span class="c1"># Test known distances</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">calculate_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">5.0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>

        <span class="c1"># Test extreme values</span>
        <span class="n">huge_val</span> <span class="o">=</span> <span class="mf">1e10</span>
        <span class="k">assert</span> <span class="n">calculate_distance</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">huge_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">huge_val</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_bbox_intersection_mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests designed to catch bbox intersection logic mutations.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.spatial_algorithms</span><span class="w"> </span><span class="kn">import</span> <span class="n">bbox_intersects</span>

        <span class="c1"># Test complete overlap</span>
        <span class="n">bbox1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">bbox2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">bbox_intersects</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>

        <span class="c1"># Test no overlap</span>
        <span class="n">bbox1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bbox2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">bbox_intersects</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span>

        <span class="c1"># Test edge touching (depends on implementation)</span>
        <span class="n">bbox1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bbox2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">bbox_intersects</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>  <span class="c1"># Should not crash</span>

        <span class="c1"># Test degenerate bboxes</span>
        <span class="n">bbox1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Point</span>
        <span class="n">bbox2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">bbox_intersects</span><span class="p">(</span><span class="n">bbox1</span><span class="p">,</span> <span class="n">bbox2</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
</code></pre></div>
<h3 id="fuzzing-for-geospatial-input-validation">Fuzzing for Geospatial Input Validation</h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">hypothesis.strategies</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hypothesis</span><span class="w"> </span><span class="kn">import</span> <span class="n">given</span><span class="p">,</span> <span class="n">assume</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">HealthCheck</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestGeospatialInputFuzzing</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fuzz testing for geospatial input handling.&quot;&quot;&quot;</span>

    <span class="nd">@given</span><span class="p">(</span>
        <span class="n">lat</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">lon</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_coordinate_validation_never_crashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Coordinate validation should never crash, regardless of input.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.spatial_validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_coordinate</span>

        <span class="c1"># Should either return True or raise a specific exception</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">validate_coordinate</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Acceptable to raise validation errors</span>
            <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="c1"># Error message should not be empty</span>

    <span class="nd">@given</span><span class="p">(</span>
        <span class="n">coords</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">tuples</span><span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">min_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nd">@settings</span><span class="p">(</span><span class="n">suppress_health_check</span><span class="o">=</span><span class="p">[</span><span class="n">HealthCheck</span><span class="o">.</span><span class="n">too_slow</span><span class="p">],</span> <span class="n">deadline</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_polygon_validation_fuzzing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Polygon validation should handle arbitrary coordinate sequences.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.spatial_validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_polygon</span>

        <span class="c1"># Ensure polygon is closed</span>
        <span class="k">if</span> <span class="n">coords</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">validate_polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

            <span class="c1"># If valid, polygon should have basic properties</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>  <span class="c1"># Minimum for closed polygon</span>
                <span class="k">assert</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Must be closed</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Acceptable exceptions for invalid input</span>
            <span class="k">pass</span>

    <span class="nd">@given</span><span class="p">(</span>
        <span class="n">geojson_like</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">recursive</span><span class="p">(</span>
            <span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">allow_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">allow_infinity</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span>
                <span class="n">st</span><span class="o">.</span><span class="n">booleans</span><span class="p">(),</span>
                <span class="n">st</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="k">lambda</span> <span class="n">children</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">one_of</span><span class="p">(</span>
                <span class="n">st</span><span class="o">.</span><span class="n">lists</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
                <span class="n">st</span><span class="o">.</span><span class="n">dictionaries</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span> <span class="n">children</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">max_leaves</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_geojson_parser_robustness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_like</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GeoJSON parser should handle arbitrary JSON-like structures.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">src.geojson_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_geojson</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">parse_geojson</span><span class="p">(</span><span class="n">geojson_like</span><span class="p">)</span>
            <span class="c1"># If parsing succeeds, result should be valid</span>
            <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Expected for invalid GeoJSON</span>
            <span class="k">pass</span>
</code></pre></div>
<h3 id="performance-and-load-testing-framework">Performance and Load Testing Framework</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SpatialLoadTestFramework</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Framework for load testing spatial services.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;requests_sent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;requests_succeeded&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;requests_failed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;total_latency&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;min_latency&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span>
            <span class="s1">&#39;max_latency&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;latencies&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_spatial_workload</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">concurrent_users</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">requests_per_user</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">test_duration_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate realistic spatial query workload.&quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">user_session</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Simulate individual user behavior.&quot;&quot;&quot;</span>
            <span class="n">requests_made</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">while</span> <span class="p">(</span><span class="n">requests_made</span> <span class="o">&lt;</span> <span class="n">requests_per_user</span> <span class="ow">and</span> 
                   <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">test_duration_seconds</span><span class="p">):</span>

                <span class="c1"># Generate realistic spatial query</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_realistic_bbox</span><span class="p">()</span>

                <span class="n">request_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/api/features/bbox&quot;</span><span class="p">,</span>
                        <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                            <span class="s1">&#39;min_lat&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;min_lon&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="s1">&#39;max_lat&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;max_lon&#39;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="p">},</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span>
                    <span class="p">)</span>

                    <span class="n">latency</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">request_start</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_record_success</span><span class="p">(</span><span class="n">latency</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_record_failure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HTTP </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_record_failure</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

                <span class="n">requests_made</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Realistic user think time</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span>

        <span class="c1"># Run concurrent user sessions</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">user_session</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">concurrent_users</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_report</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_realistic_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate realistic bounding boxes based on typical usage patterns.&quot;&quot;&quot;</span>
        <span class="c1"># Focus on populated areas with varying zoom levels</span>
        <span class="n">city_centers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">37.7749</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.4194</span><span class="p">),</span>  <span class="c1"># San Francisco</span>
            <span class="p">(</span><span class="mf">40.7128</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.0060</span><span class="p">),</span>   <span class="c1"># New York</span>
            <span class="p">(</span><span class="mf">51.5074</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1278</span><span class="p">),</span>    <span class="c1"># London</span>
            <span class="p">(</span><span class="mf">35.6762</span><span class="p">,</span> <span class="mf">139.6503</span><span class="p">),</span>   <span class="c1"># Tokyo</span>
        <span class="p">]</span>

        <span class="n">center</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">city_centers</span><span class="p">)</span>

        <span class="c1"># Random zoom level affects bbox size</span>
        <span class="n">zoom_level</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">zoom_level</span> <span class="o">-</span> <span class="mi">10</span><span class="p">))</span>  <span class="c1"># Smaller at higher zoom</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span>
        <span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">load_test</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_spatial_api_under_load</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load test for spatial API endpoints.&quot;&quot;&quot;</span>
    <span class="n">framework</span> <span class="o">=</span> <span class="n">SpatialLoadTestFramework</span><span class="p">(</span><span class="s2">&quot;http://localhost:8000&quot;</span><span class="p">)</span>

    <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">framework</span><span class="o">.</span><span class="n">generate_spatial_workload</span><span class="p">(</span>
        <span class="n">concurrent_users</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
        <span class="n">requests_per_user</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">test_duration_seconds</span><span class="o">=</span><span class="mi">60</span>
    <span class="p">)</span>

    <span class="c1"># Performance assertions</span>
    <span class="k">assert</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;success_rate&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.95</span>  <span class="c1"># 95% success rate</span>
    <span class="k">assert</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;p95_latency&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">2.0</span>    <span class="c1"># 95th percentile under 2 seconds</span>
    <span class="k">assert</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;avg_latency&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.5</span>    <span class="c1"># Average under 500ms</span>
</code></pre></div>
<h3 id="cicd-integration-patterns">CI/CD Integration Patterns</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># pytest.ini configuration for geospatial testing</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">[tool:pytest]</span>
<span class="sd">minversion = 6.0</span>
<span class="sd">addopts = </span>
<span class="sd">    -ra </span>
<span class="sd">    -q </span>
<span class="sd">    --strict-markers </span>
<span class="sd">    --strict-config</span>
<span class="sd">    --cov=src </span>
<span class="sd">    --cov-branch </span>
<span class="sd">    --cov-report=term-missing </span>
<span class="sd">    --cov-report=html</span>
<span class="sd">    --cov-fail-under=80</span>
<span class="sd">    --hypothesis-show-statistics</span>
<span class="sd">markers =</span>
<span class="sd">    unit: Unit tests</span>
<span class="sd">    integration: Integration tests</span>
<span class="sd">    load_test: Load and performance tests</span>
<span class="sd">    chaos: Chaos engineering tests</span>
<span class="sd">    slow: Tests that take more than 5 seconds</span>
<span class="sd">    spatial: Tests that require spatial data/operations</span>
<span class="sd">    external: Tests that require external services</span>
<span class="sd">testpaths = tests</span>
<span class="sd">python_files = test_*.py</span>
<span class="sd">python_classes = Test*</span>
<span class="sd">python_functions = test_*</span>
<span class="sd">filterwarnings =</span>
<span class="sd">    error</span>
<span class="sd">    ignore::UserWarning</span>
<span class="sd">    ignore::DeprecationWarning</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GeospatialTestConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for geospatial test environments.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_test_database</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up PostGIS test database.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">psycopg2</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">psycopg2.extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span>

        <span class="c1"># Create test database with PostGIS</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span><span class="p">,</span> 
            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
        <span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">set_isolation_level</span><span class="p">(</span><span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DROP DATABASE IF EXISTS test_geospatial&quot;</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE DATABASE test_geospatial&quot;</span><span class="p">)</span>

        <span class="c1"># Connect to test database and enable PostGIS</span>
        <span class="n">test_conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="s2">&quot;postgres&quot;</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="s2">&quot;test_geospatial&quot;</span>
        <span class="p">)</span>
        <span class="n">test_cursor</span> <span class="o">=</span> <span class="n">test_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">test_cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;CREATE EXTENSION IF NOT EXISTS postgis&quot;</span><span class="p">)</span>
        <span class="n">test_conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">return</span> <span class="s2">&quot;postgresql://postgres:password@localhost/test_geospatial&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_test_data</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate test spatial datasets.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Polygon</span>

        <span class="c1"># Generate synthetic spatial data</span>
        <span class="n">test_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="c1"># Random points around San Francisco</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="mf">37.7749</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">122.4194</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

            <span class="n">feature</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;feature_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">),</span>
                <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Test Feature </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;restaurant&#39;</span><span class="p">,</span> <span class="s1">&#39;shop&#39;</span><span class="p">,</span> <span class="s1">&#39;park&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">test_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>

        <span class="c1"># Create GeoDataFrame and save as test file</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">test_features</span><span class="p">)</span>
        <span class="n">gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;test_data/synthetic_features.geojson&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GeoJSON&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gdf</span>

<span class="c1"># GitHub Actions workflow for geospatial testing</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">name: Geospatial Testing Pipeline</span>

<span class="sd">on:</span>
<span class="sd">  push:</span>
<span class="sd">    branches: [ main, develop ]</span>
<span class="sd">  pull_request:</span>
<span class="sd">    branches: [ main ]</span>

<span class="sd">jobs:</span>
<span class="sd">  test:</span>
<span class="sd">    runs-on: ubuntu-latest</span>

<span class="sd">    services:</span>
<span class="sd">      postgres:</span>
<span class="sd">        image: postgis/postgis:13-3.1</span>
<span class="sd">        env:</span>
<span class="sd">          POSTGRES_PASSWORD: password</span>
<span class="sd">          POSTGRES_DB: test_geospatial</span>
<span class="sd">        options: &gt;-</span>
<span class="sd">          --health-cmd pg_isready</span>
<span class="sd">          --health-interval 10s</span>
<span class="sd">          --health-timeout 5s</span>
<span class="sd">          --health-retries 5</span>
<span class="sd">        ports:</span>
<span class="sd">          - 5432:5432</span>

<span class="sd">    steps:</span>
<span class="sd">    - uses: actions/checkout@v3</span>

<span class="sd">    - name: Set up Python</span>
<span class="sd">      uses: actions/setup-python@v4</span>
<span class="sd">      with:</span>
<span class="sd">        python-version: &#39;3.11&#39;</span>

<span class="sd">    - name: Install GDAL</span>
<span class="sd">      run: |</span>
<span class="sd">        sudo apt-get update</span>
<span class="sd">        sudo apt-get install -y gdal-bin libgdal-dev</span>

<span class="sd">    - name: Install dependencies</span>
<span class="sd">      run: |</span>
<span class="sd">        pip install -r requirements.txt</span>
<span class="sd">        pip install -r requirements-test.txt</span>

<span class="sd">    - name: Run unit tests</span>
<span class="sd">      run: pytest tests/ -m &quot;unit&quot; --cov=src --cov-report=xml</span>

<span class="sd">    - name: Run integration tests</span>
<span class="sd">      run: pytest tests/ -m &quot;integration&quot; </span>
<span class="sd">      env:</span>
<span class="sd">        DATABASE_URL: postgresql://postgres:password@localhost:5432/test_geospatial</span>

<span class="sd">    - name: Run spatial accuracy tests</span>
<span class="sd">      run: pytest tests/ -m &quot;spatial&quot; --hypothesis-show-statistics</span>

<span class="sd">    - name: Upload coverage reports</span>
<span class="sd">      uses: codecov/codecov-action@v3</span>
<span class="sd">      with:</span>
<span class="sd">        file: ./coverage.xml</span>
<span class="sd">        flags: unittests</span>
<span class="sd">        name: codecov-umbrella</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="data-driven-testing-for-geospatial-systems">Data-Driven Testing for Geospatial Systems</h2>
<h3 id="test-data-management">Test Data Management</h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SpatialTestDataManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages test datasets for geospatial testing.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">generator_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a test dataset generator.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">generator_func</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or generate a test dataset.&quot;&quot;&quot;</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">.pkl&quot;</span>

        <span class="k">if</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Generate dataset</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Cache for future use</span>
        <span class="n">cache_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dataset</span>

<span class="c1"># Test data generators</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_road_network</span><span class="p">(</span><span class="n">num_roads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">area_bounds</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate synthetic road network for testing.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">area_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">area_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">37.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.5</span><span class="p">,</span> <span class="mf">37.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">122.4</span><span class="p">)</span>  <span class="c1"># SF area</span>

    <span class="n">roads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_roads</span><span class="p">):</span>
        <span class="c1"># Generate random road segments</span>
        <span class="n">start_lat</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">area_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">start_lon</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">area_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">area_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1"># Random direction and length</span>
        <span class="n">bearing</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># degrees</span>

        <span class="n">end_lat</span> <span class="o">=</span> <span class="n">start_lat</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bearing</span><span class="p">))</span>
        <span class="n">end_lon</span> <span class="o">=</span> <span class="n">start_lon</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bearing</span><span class="p">))</span>

        <span class="n">road</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;road_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;LINESTRING(</span><span class="si">{</span><span class="n">start_lon</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">start_lat</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">end_lon</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">end_lat</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Test Road </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;speed_limit&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">55</span><span class="p">]),</span>
                <span class="s1">&#39;road_type&#39;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;residential&#39;</span><span class="p">,</span> <span class="s1">&#39;arterial&#39;</span><span class="p">,</span> <span class="s1">&#39;highway&#39;</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">roads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">road</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">roads</span>

<span class="c1"># Usage in tests</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;session&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">spatial_test_data</span><span class="p">():</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">SpatialTestDataManager</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test_data&quot;</span><span class="p">))</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">register_dataset</span><span class="p">(</span><span class="s2">&quot;road_network&quot;</span><span class="p">,</span> <span class="n">generate_road_network</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">manager</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestWithSpatialData</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_road_network_loading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spatial_test_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test road network loading with different dataset sizes.&quot;&quot;&quot;</span>
        <span class="n">small_network</span> <span class="o">=</span> <span class="n">spatial_test_data</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="s2">&quot;road_network&quot;</span><span class="p">,</span> <span class="n">num_roads</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">large_network</span> <span class="o">=</span> <span class="n">spatial_test_data</span><span class="o">.</span><span class="n">get_dataset</span><span class="p">(</span><span class="s2">&quot;road_network&quot;</span><span class="p">,</span> <span class="n">num_roads</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">small_network</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">large_network</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1000</span>
</code></pre></div>
<h2 id="resources">Resources</h2>
<h3 id="testing-frameworks-and-tools">Testing Frameworks and Tools</h3>
<ul>
<li><a href="https://docs.pytest.org/">pytest Documentation</a></li>
<li><a href="https://pytest-cov.readthedocs.io/">pytest-cov Coverage Plugin</a></li>
<li><a href="https://hypothesis.readthedocs.io/">Hypothesis Property-Based Testing</a></li>
<li><a href="https://mutmut.readthedocs.io/">mutmut Mutation Testing</a></li>
<li><a href="https://locust.io/">locust Load Testing</a></li>
</ul>
<h3 id="geospatial-testing">Geospatial Testing</h3>
<ul>
<li><a href="https://postgis.net/documentation/">PostGIS Testing Guide</a></li>
<li><a href="https://gdal.org/development/testing.html">GDAL/OGR Test Suite</a></li>
<li><a href="https://shapely.readthedocs.io/">Shapely Testing Patterns</a></li>
</ul>
<h3 id="quality-engineering">Quality Engineering</h3>
<ul>
<li><a href="https://fastapi.tiangolo.com/tutorial/testing/">FastAPI Testing Guide</a></li>
<li><a href="https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530">Test-Driven Development by Example</a></li>
<li><a href="https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627">Growing Object-Oriented Software, Guided by Tests</a></li>
<li><a href="https://software.nasa.gov/">Building Quality Software by NASA</a></li>
</ul>
<h3 id="chaos-engineering">Chaos Engineering</h3>
<ul>
<li><a href="https://principlesofchaos.org/">Principles of Chaos Engineering</a></li>
<li><a href="https://netflix.github.io/chaosmonkey/">Chaos Monkey for Spatial Systems</a></li>
</ul>
<p>This comprehensive testing module ensures that geospatial systems are robust, reliable, and performant under all conditions, from normal operation to extreme failure scenarios.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.follow", "search.suggest", "content.code.copy"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
    
  </body>
</html>